# Windows 平台移植与部署指南

本文档旨在指导用户如何在 Windows 电脑上部署 FastAPI 代理后端和 Vue 前端，以实现远程访问运行在 Ubuntu 服务器上的 Gazebo 仿真环境。

---

## 目标

- **服务器 (Ubuntu)**: 仅运行 Gazebo 和 VNC 服务，作为“画面源”。
- **客户端 (Windows)**: 运行 FastAPI 代理和前端，作为“控制器”和“显示器”。

---

## 一、Windows 环境准备

在开始之前，请确保您的 Windows 电脑上已安装以下软件：

1.  **Git**: 用于从代码仓库克隆项目。
    - [下载地址](https://git-scm.com/download/win)
2.  **Python (3.9 或更高版本)**: 用于运行 FastAPI 后端。
    - [下载地址](https://www.python.org/downloads/)
    - **重要**: 在安装时，请务必勾选 `Add Python to PATH` 选项。
3.  **Node.js (LTS 版本)**: 用于运行 Vue 前端项目。
    - [下载地址](https://nodejs.org/)
    - `npm` (Node 包管理器) 会随 Node.js 一同安装。
4.  **代码编辑器**: 推荐使用 Visual Studio Code。
    - [下载地址](https://code.visualstudio.com/)
5.  **终端**: 推荐使用 Windows Terminal 或 PowerShell 7。

---

## 二、操作步骤

### 第 1 步：准备 Ubuntu 服务器

1.  **获取服务器 IP 地址**: 在 Ubuntu 服务器终端中运行 `ip addr`，找到您的局域网或公网 IP 地址。
2.  **启动服务**: 登录到 Ubuntu 服务器，进入项目目录，并运行启动脚本。
    ```bash
    cd /path/to/your/noVNCdemo
    ./scripts/start_services.sh
    ```
3.  **检查防火墙**: 确保服务器的防火墙允许外部访问 VNC 端口（默认为 `5900`）。如果您的服务器有防火墙（如 `ufw`），您可能需要执行：
    ```bash
    sudo ufw allow 5900/tcp
    ```

### 第 2 步：在 Windows 上获取项目代码

打开 PowerShell 或 Git Bash，克隆项目到您的本地电脑。

```powershell
git clone <您的项目仓库地址>
cd noVNCdemo
```

### 第 3 步：在 Windows 上运行 FastAPI 后端

1.  **进入后端目录**:
    ```powershell
    cd backend
    ```

2.  **创建并激活 Python 虚拟环境**:
    ```powershell
    # 创建虚拟环境
    python -m venv venv

    # 激活虚拟环境 (注意路径和命令)
    .\venv\Scripts\Activate.ps1
    ```
    *如果激活失败，提示执行策略问题，请先运行 `Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass` 然后重试。*

3.  **安装依赖包**:
    ```powershell
    pip install -r requirements.txt
    ```

4.  **设置环境变量并启动服务**:
    将 `<服务器IP地址>` 替换为您在第 1 步中获取的真实 IP。
    ```powershell
    # 设置 VNC 服务器地址的环境变量
    $env:VNC_HOST="<服务器IP地址>"

    # (可选) 如果服务器 VNC 端口不是 5900，也需要设置
    # $env:VNC_PORT="<端口号>"

    # 启动 FastAPI 服务
    uvicorn main:app --host 0.0.0.0 --port 8000
    ```

5.  **验证**: 终端会显示服务正在 `http://0.0.0.0:8000` 上运行。**请保持此终端窗口开启**。

### 第 4 步：在 Windows 上运行 Vue 前端

1.  **打开一个新的 PowerShell 终端**。

2.  **进入前端目录**:
    ```powershell
    cd path\to\your\noVNCdemo\frontend
    ```

3.  **安装依赖包**:
    ```powershell
    npm install
    ```

4.  **启动前端开发服务器**:
    ```powershell
    npm run serve
    ```

5.  **验证**: 终端会显示项目已编译成功，并提供一个本地访问地址，通常是 `http://localhost:8080`。

### 第 5 步：访问应用

1.  在您的 Windows 电脑上打开 Chrome 或 Edge 浏览器。
2.  访问 `npm run serve` 命令提供的地址（例如 `http://localhost:8080`）。
3.  您应该能看到 noVNC 的连接界面，它会自动连接。
4.  如果服务器端设置了 VNC 密码，界面会提示您输入密码（默认为 `123456`）。
5.  成功连接后，您就可以在浏览器中看到并操作远程 Ubuntu 服务器上的 Gazebo 界面了。

---

## 三、常见问题排查 (Troubleshooting)

- **浏览器无法连接 (转圈或报错)**:
  1.  检查 FastAPI 后端终端是否有错误信息。
  2.  确认 `<服务器IP地址>` 是否正确，并且 Windows 电脑可以 `ping` 通该地址。
  3.  确认服务器防火墙已放行 `5900` 端口。

- **VNC 连接失败 (noVNC 界面提示错误)**:
  1.  确认 Ubuntu 服务器上的 `start_services.sh` 脚本正在运行。
  2.  确认 FastAPI 终端中设置的 `VNC_HOST` 环境变量是正确的。

- **输入密码错误**:
  1.  检查 `scripts/start_services.sh` 文件中的 `VNC_PASSWORD` 变量，确保输入正确。